# -*- coding: utf-8 -*-# Code by Yinzo:        https://github.com/Yinzo# Origin repository:    https://github.com/Yinzo/SmartQQBotimport sysimport getoptimport loggingimport socketimport tracebackfrom MsgHandler import QQ, MsgHandlerbot_params = {    "debug": False,    "pid": 0,    "config_path": None,    "qrcode_path": './v.png',    "login_retry_time": 10,    "qq_code": 985388576,    "report_port": 30001,    "mojo_port": 30000}logging.basicConfig(    filename='smartqq.log',    level=logging.DEBUG,    format='%(asctime)s  %(filename)s[line:%(lineno)d] %(levelname)s %(message)s',    datefmt='%a, %d %b %Y %H:%M:%S',)def bot_launch(sys_paras):    bot = QQ(sys_paras)    if not bot.login_by_qrcode():         print "bot launch failed"        bot.close()        return (None, None)    bot_handler = MsgHandler(bot)    return (bot, bot_handler)def bot_loop(bot, bot_handler):    while 1:        try:            new_msg = bot.check_msg()            if new_msg is None:                logging.info("Bot asked for quit")                bot.close()                break            elif new_msg:                bot_handler.handle(new_msg)        except Exception, e:            print traceback.format_exc()            logging.warning("An error has occured when handling message. Error traceback:\n" + traceback.format_exc())            continueif __name__ == '__main__':    reload(sys)    sys.setdefaultencoding("utf-8")    options, args = getopt.getopt(sys.argv[1:], "dp:c:q:t:", ['debug', 'pid=', 'config-path=', 'qrcode-path=', 'login-retry-time=', 'report-port=', 'bot-port='])    for k,v in options:        if k in ['-d', '--debug']:            bot_params['debug'] = True        elif k in ['-p', '--pid']:            bot_params['pid'] = v        elif k in ['-c', '--config-path']:            bot_params['config_path'] = v        elif k in ['-q', '--qrcode-path']:            bot_params['qrcode_path'] = v        elif k in ['-t', '--login-retry-time'] and v.isdigit():            bot_params['login_retry_time'] = int(v)        elif k in ['-n', '--qq'] and v.isdigit():            bot_params['qq_code'] = int(v)        elif k in ['-n', '--report-port'] and v.isdigit():            bot_params['report_port'] = int(v)        elif k in ['-n', '--bot-port'] and v.isdigit():            bot_params['mojo_port'] = int(v)    (bot, bot_handler) = bot_launch(bot_params)    if not bot is None and not bot_handler is None:        bot_loop(bot, bot_handler)